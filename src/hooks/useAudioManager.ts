/**
 * üéµ useAudioManager.ts - –ö–∞—Å—Ç–æ–º–Ω—ã–π —Ö—É–∫ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–≤—É–∫–∞–º–∏ –∏ –º—É–∑—ã–∫–æ–π
 * 
 * –û–°–ù–û–í–ù–û–ô –§–£–ù–ö–¶–ò–û–ù–ê–õ:
 * ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –∑–≤—É–∫–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
 * ‚úÖ –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–æ–≤ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ (–¥–≤–∏–∂–µ–Ω–∏–µ, –≤—Ä–∞—â–µ–Ω–∏–µ, –ø–∞–¥–µ–Ω–∏–µ –∏ —Ç.–¥.)
 * ‚úÖ –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–Ω–∏–µ —Ü–∏–∫–ª–∏—á–µ—Å–∫–æ–π —Ñ–æ–Ω–æ–≤–æ–π –º—É–∑—ã–∫–∏
 * ‚úÖ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –º—É–∑—ã–∫–∏ –ø—Ä–∏ –ø–∞—É–∑–µ/–≤—ã—Ö–æ–¥–µ
 * ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä–æ–º–∫–æ—Å—Ç—å—é –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫
 * ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –Ω–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–ª–µ–µ—Ä–∞
 */

import { useCallback, useRef, useEffect } from 'react';
import { Audio } from 'expo-av'; // –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∞—É–¥–∏–æ
import { useAudio } from '../context/AudioContext'; // –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫

// ========================================
// üìä –¢–ò–ü–´ –ò –ò–ù–¢–ï–†–§–ï–ô–°–´
// ========================================

/**
 * SoundFiles - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å–µ—Ö –∑–≤—É–∫–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏–≥—Ä—ã
 * 
 * –ö–∞–∂–¥—ã–π –∫–ª—é—á —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∑–≤—É–∫–æ–≤–æ–º—É —ç—Ñ—Ñ–µ–∫—Ç—É, –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–º—É –≤ –∏–≥—Ä–µ
 */
interface SoundFiles {
  background_music: any;    // üéµ –§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞ (—Ü–∏–∫–ª–∏—á–µ—Å–∫–∞—è)
  move: any;               // üëà –ó–≤—É–∫ –¥–≤–∏–∂–µ–Ω–∏—è —Ñ–∏–≥—É—Ä—ã
  rotate: any;             // üîÑ –ó–≤—É–∫ –≤—Ä–∞—â–µ–Ω–∏—è —Ñ–∏–≥—É—Ä—ã
  hard_drop: any;          // ‚¨áÔ∏è –ó–≤—É–∫ –±—ã—Å—Ç—Ä–æ–≥–æ –ø–∞–¥–µ–Ω–∏—è
  line_clear: any;         // ‚ú® –ó–≤—É–∫ –æ—á–∏—Å—Ç–∫–∏ –ª–∏–Ω–∏–∏
  word_found: any;         // üìù –ó–≤—É–∫ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ —Å–ª–æ–≤–∞
  game_over: any;          // üíÄ –ó–≤—É–∫ –∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã
  level_up: any;           // üÜô –ó–≤—É–∫ –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è
  hold: any;               // üéØ –ó–≤—É–∫ —É–¥–µ—Ä–∂–∞–Ω–∏—è —Ñ–∏–≥—É—Ä—ã
}

/**
 * SoundKey - —Ç–∏–ø –¥–ª—è –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–≤—É–∫–æ–≤
 * 
 * –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–∏ –≤—ã–∑–æ–≤–µ playSound()
 */
type SoundKey = keyof SoundFiles;

/**
 * AudioManagerReturn - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –º–µ—Ç–æ–¥–æ–≤
 * 
 * –û–ø–∏—Å—ã–≤–∞–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π API —Ö—É–∫–∞ useAudioManager
 */
interface AudioManagerReturn {
  playSound: (soundName: SoundKey) => Promise<void>;        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∑–≤—É–∫
  playBackgroundMusic: () => Promise<void>;                 // –ó–∞–ø—É—Å—Ç–∏—Ç—å –º—É–∑—ã–∫—É
  stopBackgroundMusic: () => Promise<void>;                 // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º—É–∑—ã–∫—É
}

// ========================================
// ü™ù –ì–õ–ê–í–ù–´–ô –•–£–ö
// ========================================

/**
 * useAudioManager - –∫–∞—Å—Ç–æ–º–Ω—ã–π —Ö—É–∫ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—É–¥–∏–æ –≤ –∏–≥—Ä–µ
 * 
 * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ –∑–≤—É–∫–∏, —É–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ–º,
 * –æ–±–Ω–æ–≤–ª—è–µ—Ç –≥—Ä–æ–º–∫–æ—Å—Ç—å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
 * 
 * @returns –æ–±—ä–µ–∫—Ç —Å –º–µ—Ç–æ–¥–∞–º–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–≤—É–∫–∞–º–∏
 * 
 * @example
 * ```tsx
 * const { playSound, playBackgroundMusic, stopBackgroundMusic } = useAudioManager();
 * 
 * // –ó–∞–ø—É—Å—Ç–∏—Ç—å –º—É–∑—ã–∫—É
 * playBackgroundMusic();
 * 
 * // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∑–≤—É–∫ –¥–≤–∏–∂–µ–Ω–∏—è
 * playSound('move');
 * 
 * // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º—É–∑—ã–∫—É –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ
 * stopBackgroundMusic();
 * ```
 */
export const useAudioManager = (): AudioManagerReturn => {
  // ========================================
  // üì¶ –°–û–°–¢–û–Ø–ù–ò–ï –ò –°–°–´–õ–ö–ò
  // ========================================

  /**
   * audioSettings - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä–æ–º–∫–æ—Å—Ç–∏ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
   * 
   * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–∫–ª—é—á–µ–Ω—ã –ª–∏ –∑–≤—É–∫–∏ –∏ —Ç–µ–∫—É—â–µ–π –≥—Ä–æ–º–∫–æ—Å—Ç–∏
   */
  const { audioSettings } = useAudio();

  /**
   * soundsRef - —Å—Å—ã–ª–∫–∞ –Ω–∞ –≤—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ Sound –æ–±—ä–µ–∫—Ç—ã
   * 
   * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è useRef –≤–º–µ—Å—Ç–æ useState –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏–≤–∞—Ç—å
   * –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∑–≤—É–∫–æ–≤, –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ —Ö—Ä–∞–Ω–∏—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ –Ω–∏—Ö
   * 
   * @type {{ [key in SoundKey]?: Audio.Sound }}
   */
  const soundsRef = useRef<{ [key in SoundKey]?: Audio.Sound }>({});

  /**
   * backgroundMusicPlayingRef - —Ñ–ª–∞–≥ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —Ñ–æ–Ω–æ–≤–æ–π –º—É–∑—ã–∫–∏
   * 
   * –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –∑–∞–ø—É—Å–∫ –º—É–∑—ã–∫–∏ –µ—Å–ª–∏ –æ–Ω–∞ —É–∂–µ –∏–≥—Ä–∞–µ—Ç
   * –≠—Ç–æ –æ—á–µ–Ω—å –≤–∞–∂–Ω–æ –ø–æ—Ç–æ–º—É —á—Ç–æ playBackgroundMusic –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –º–Ω–æ–≥–æ —Ä–∞–∑
   */
  const backgroundMusicPlayingRef = useRef(false);

  // ========================================
  // üéµ –ó–í–£–ö–û–í–´–ï –§–ê–ô–õ–´
  // ========================================

  /**
   * soundFiles - –æ–±—ä–µ–∫—Ç —Å–æ –≤—Å–µ–º–∏ –∑–≤—É–∫–æ–≤—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏
   * 
   * –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é require()
   * –ü—É—Ç–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã –∫ –∫–æ—Ä–Ω—é –ø—Ä–æ–µ–∫—Ç–∞ (–Ω–∞—á–∏–Ω–∞—è —Å assets/)
   * 
   * –í–ê–ñ–ù–û: –∑–≤—É–∫–æ–≤—ã–µ —Ñ–∞–π–ª—ã –¥–æ–ª–∂–Ω—ã –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –ø–∞–ø–∫–µ assets/sounds/
   */
  const soundFiles: SoundFiles = {
    background_music: require('../../assets/sounds/background.mp3'),  // –¶–∏–∫–ª–∏—á–µ—Å–∫–∞—è –º—É–∑—ã–∫–∞
    move: require('../../assets/sounds/move.wav'),                    // –ö–æ—Ä–æ—Ç–∫–∏–π –∑–≤—É–∫
    rotate: require('../../assets/sounds/rotate.wav'),                // –ö–æ—Ä–æ—Ç–∫–∏–π –∑–≤—É–∫
    hard_drop: require('../../assets/sounds/hard_drop.wav'),          // –ö–æ—Ä–æ—Ç–∫–∏–π –∑–≤—É–∫
    line_clear: require('../../assets/sounds/line_clear.mp3'),        // –î–ª–∏–Ω–Ω—ã–π –∑–≤—É–∫
    word_found: require('../../assets/sounds/move.wav'),              // –í—Ä–µ–º–µ–Ω–Ω–æ move
    game_over: require('../../assets/sounds/move.wav'),               // –í—Ä–µ–º–µ–Ω–Ω–æ move
    level_up: require('../../assets/sounds/move.wav'),                // –í—Ä–µ–º–µ–Ω–Ω–æ move
    hold: require('../../assets/sounds/move.wav'),                    // –í—Ä–µ–º–µ–Ω–Ω–æ move
  };

  // ========================================
  // üöÄ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ó–í–£–ö–û–í
  // ========================================

  /**
   * Effect –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö –∑–≤—É–∫–æ–≤ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
   * 
   * –ü–†–û–¶–ï–°–°:
   * 1. –í–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞ –≤ —Ñ–æ–Ω–µ (–¥–ª—è iOS)
   * 2. –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞–∂–¥—ã–π –∑–≤—É–∫ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏
   * 3. –°–æ—Ö—Ä–∞–Ω—è–µ–º Sound –æ–±—ä–µ–∫—Ç—ã –≤ soundsRef
   * 4. –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –µ—Å–ª–∏ –∑–≤—É–∫ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω
   * 
   * CLEANUP:
   * - –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –∑–≤—É–∫–∏
   * - –í—ã–≥—Ä—É–∂–∞–µ–º (unload) –≤—Å–µ –∑–≤—É–∫–∏ –∏–∑ –ø–∞–º—è—Ç–∏
   * - –≠—Ç–æ –≤–∞–∂–Ω–æ —á—Ç–æ–±—ã –æ—Å–≤–æ–±–æ–¥–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
   */
  useEffect(() => {
    let isMounted = true; // –§–ª–∞–≥ —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏

    /**
     * initializeSounds - –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ –∑–≤—É–∫–æ–≤—ã–µ —Ñ–∞–π–ª—ã
     * 
     * –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø–æ—Ç–æ–º—É —á—Ç–æ –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Ä–µ–º—è
     */
    const initializeSounds = async (): Promise<void> => {
      try {
        // ========================================
        // üîß –ù–ê–°–¢–†–û–ô–ö–ê –†–ï–ñ–ò–ú–ê –ê–£–î–ò–û
        // ========================================

        /**
         * –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–µ–∂–∏–º–∞ –¥–ª—è iOS:
         * - playsInSilentModeIOS: true - –∑–≤—É–∫–∏ –∏–≥—Ä–∞—é—Ç –¥–∞–∂–µ –≤ —Ä–µ–∂–∏–º–µ "–ù–µ –±–µ—Å–ø–æ–∫–æ–∏—Ç—å"
         * - staysActiveInBackground: true - –∞—É–¥–∏–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –∏–≥—Ä–∞—Ç—å –≤ —Ñ–æ–Ω–µ
         */
        await Audio.setAudioModeAsync({
          playsInSilentModeIOS: true,      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Ä–µ–∂–∏–º "–ù–µ –±–µ—Å–ø–æ–∫–æ–∏—Ç—å"
          staysActiveInBackground: true,   // –ó–≤—É–∫ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
        });

        // ========================================
        // üìÇ –ó–ê–ì–†–£–ó–ö–ê –ö–ê–ñ–î–û–ì–û –ó–í–£–ö–ê
        // ========================================

        /**
         * –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –∫–∞–∂–¥–æ–º—É –∑–≤—É–∫—É –∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –µ–≥–æ
         */
        for (const [key, file] of Object.entries(soundFiles)) {
          if (isMounted) {
            try {
              /**
               * Audio.Sound.createAsync –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∑–≤—É–∫–æ–≤–æ–π —Ñ–∞–π–ª
               * 
               * –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
               * - file: –ø—É—Ç—å –∏–ª–∏ require() –æ–±—ä–µ–∫—Ç –∑–≤—É–∫–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞
               * - options:
               *   - isLooping: false - –∑–≤—É–∫ –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è (–∏—Å–∫–ª—é—á–µ–Ω–∏–µ - –º—É–∑—ã–∫–∞)
               *   - progressUpdateIntervalMillis: 500 - –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥—ã–µ 500–º—Å
               */
              const { sound } = await Audio.Sound.createAsync(file, {
                isLooping: false,                    // –ó–≤—É–∫–∏ –Ω–µ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ
                progressUpdateIntervalMillis: 500,   // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
              });

              // –°–æ—Ö—Ä–∞–Ω—è–µ–º Sound –æ–±—ä–µ–∫—Ç –≤ ref –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
              soundsRef.current[key as SoundKey] = sound;
              console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω –∑–≤—É–∫: ${key}`);

            } catch (err) {
              /**
               * –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ–¥–Ω–æ–≥–æ –∑–≤—É–∫–∞, –ª–æ–≥–∏—Ä—É–µ–º –Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
               * –í–∞–∂–Ω–æ —á—Ç–æ–±—ã –æ–¥–Ω–∞ –æ—à–∏–±–∫–∞ –Ω–µ —Å–ª–æ–º–∞–ª–∞ –≤—Å—é —Å–∏—Å—Ç–µ–º—É
               */
              console.error(`‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${key}:`, err);
            }
          }
        }

        console.log('‚úÖ –í—Å–µ –∑–≤—É–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');

      } catch (error) {
        /**
         * –û–±—â–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä –ø—Ä–∏ setAudioModeAsync)
         */
        console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∞—É–¥–∏–æ:', error);
      }
    };

    // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
    initializeSounds();

    // ========================================
    // üßπ CLEANUP –§–£–ù–ö–¶–ò–Ø
    // ========================================

    /**
     * –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–æ–≥–¥–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è
     * –û—á–∏—â–∞–µ—Ç –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã
     */
    return () => {
      isMounted = false; // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–ø—ã—Ç–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
      backgroundMusicPlayingRef.current = false; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –º—É–∑—ã–∫–∏

      /**
       * –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º –∑–≤—É–∫–∞–º –∏ –≤—ã–≥—Ä—É–∂–∞–µ–º –∏—Ö
       */
      Object.values(soundsRef.current).forEach((sound: Audio.Sound | undefined) => {
        if (sound) {
          // –°–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ–º—Å—è –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å (—ç—Ç–æ –º–æ–∂–µ—Ç –∏–Ω–æ–≥–¥–∞ –≤—ã–∑–≤–∞—Ç—å –æ—à–∏–±–∫—É)
          sound.stopAsync().catch(() => {
            // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
          });

          // –ó–∞—Ç–µ–º –≤—ã–≥—Ä—É–∂–∞–µ–º –∏–∑ –ø–∞–º—è—Ç–∏
          sound.unloadAsync().catch(err => 
            console.error('Error unloading sound:', err)
          );
        }
      });
    };
  }, []); // –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π - —ç—Ñ—Ñ–µ–∫—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

  // ========================================
  // üîä –í–û–°–ü–†–û–ò–ó–í–ï–î–ï–ù–ò–ï –ó–í–£–ö–û–í
  // ========================================

  /**
   * playSound - –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –∑–≤—É–∫–æ–≤–æ–π —ç—Ñ—Ñ–µ–∫—Ç
   * 
   * –õ–û–ì–ò–ö–ê:
   * 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∫–ª—é—á–µ–Ω—ã –ª–∏ –∑–≤—É–∫–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
   * 2. –ü–æ–ª—É—á–∞–µ–º Sound –æ–±—ä–µ–∫—Ç –ø–æ –∫–ª—é—á—É
   * 3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥—Ä–æ–º–∫–æ—Å—Ç—å –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫
   * 4. –ü–µ—Ä–µ–º–µ—â–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –Ω–∞ –Ω–∞—á–∞–ª–æ (—ç—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø—Ä–æ–∏–≥—Ä–∞—Ç—å)
   * 5. –ó–∞–ø—É—Å–∫–∞–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
   * 
   * @param soundName - –∫–ª—é—á –∑–≤—É–∫–∞ –∏–∑ SoundKey (–Ω–∞–ø—Ä–∏–º–µ—Ä 'move', 'rotate')
   */
  const playSound = useCallback(
    async (soundName: SoundKey): Promise<void> => {
      // ========================================
      // 1Ô∏è‚É£ –ü–†–û–í–ï–†–ö–ê –í–ö–õ–Æ–ß–ï–ù–´ –õ–ò –ó–í–£–ö–ò
      // ========================================

      if (!audioSettings.soundsEnabled) {
        console.log('üîá –ó–≤—É–∫–∏ –æ—Ç–∫–ª—é—á–µ–Ω—ã –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö');
        return; // –í—ã—Ö–æ–¥–∏–º –µ—Å–ª–∏ –∑–≤—É–∫–∏ –æ—Ç–∫–ª—é—á–µ–Ω—ã
      }

      try {
        // ========================================
        // 2Ô∏è‚É£ –ü–û–õ–£–ß–ï–ù–ò–ï SOUND –û–ë–™–ï–ö–¢–ê
        // ========================================

        const sound = soundsRef.current[soundName];

        if (sound) {
          // ========================================
          // 3Ô∏è‚É£ –£–°–¢–ê–ù–û–í–ö–ê –ì–†–û–ú–ö–û–°–¢–ò
          // ========================================

          /**
           * –ì—Ä–æ–º–∫–æ—Å—Ç—å —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö (0-100)
           * –Ω–æ Audio API –æ–∂–∏–¥–∞–µ—Ç —á–∏—Å–ª–æ 0-1
           * –ü–æ—ç—Ç–æ–º—É –¥–µ–ª–∏–º –Ω–∞ 100
           */
          const volume = audioSettings.soundsVolume / 100;
          await sound.setVolumeAsync(volume);

          // ========================================
          // 4Ô∏è‚É£ –ü–ï–†–ï–ú–ï–©–ï–ù–ò–ï –ù–ê –ù–ê–ß–ê–õ–û
          // ========================================

          /**
           * –ï—Å–ª–∏ –∑–≤—É–∫ —É–∂–µ –±—ã–ª –ø—Ä–æ–∏–≥—Ä–∞–Ω, –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –Ω–∞ –Ω–∞—á–∞–ª–æ
           * setPositionAsync(0) - –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç –Ω–∞ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞
           */
          await sound.setPositionAsync(0);

          // ========================================
          // 5Ô∏è‚É£ –í–û–°–ü–†–û–ò–ó–í–ï–î–ï–ù–ò–ï
          // ========================================

          await sound.playAsync();
          console.log(`üîä –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫: ${soundName}`);

        } else {
          /**
           * –ó–≤—É–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ soundsRef
           * –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –±—ã–ª –∑–∞–≥—Ä—É–∂–µ–Ω –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–ª—é—á
           */
          console.warn(`‚ö†Ô∏è –ó–≤—É–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω: ${soundName}`);
        }

      } catch (error) {
        console.error(`‚ùå –û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è ${soundName}:`, error);
      }
    },
    [audioSettings.soundsEnabled, audioSettings.soundsVolume] // –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
  );

  // ========================================
  // üéµ –í–û–°–ü–†–û–ò–ó–í–ï–î–ï–ù–ò–ï –§–û–ù–û–í–û–ô –ú–£–ó–´–ö–ò
  // ========================================

  /**
   * playBackgroundMusic - –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫—É—é —Ñ–æ–Ω–æ–≤—É—é –º—É–∑—ã–∫—É
   * 
   * –û–°–û–ë–ï–ù–ù–û–°–¢–ò:
   * ‚≠ê –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ - –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç –º—É–∑—ã–∫—É –µ—Å–ª–∏ –æ–Ω–∞ —É–∂–µ –∏–≥—Ä–∞–µ—Ç
   * ‚≠ê –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ (isLooping: true)
   * ‚≠ê –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º—É–∑—ã–∫–∏ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
   * 
   * –õ–û–ì–ò–ö–ê:
   * 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∫–ª—é—á–µ–Ω–∞ –ª–∏ –º—É–∑—ã–∫–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
   * 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–∂–µ –ª–∏ –∏–≥—Ä–∞–µ—Ç –º—É–∑—ã–∫–∞ (backgroundMusicPlayingRef)
   * 3. –ï—Å–ª–∏ —É–∂–µ –∏–≥—Ä–∞–µ—Ç - –≤—ã—Ö–æ–¥–∏–º (—ç—Ç–æ –ö–†–ò–¢–ò–ß–ï–°–ö–ò –≤–∞–∂–Ω–æ!)
   * 4. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –µ—Å–ª–∏ –≤–¥—Ä—É–≥ —á—Ç–æ-—Ç–æ –±—ã–ª–æ
   * 5. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥—Ä–æ–º–∫–æ—Å—Ç—å
   * 6. –í–∫–ª—é—á–∞–µ–º —Ü–∏–∫–ª–∏—á–µ—Å–∫–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
   * 7. –ó–∞–ø—É—Å–∫–∞–µ–º —Å –Ω–∞—á–∞–ª–∞
   * 8. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ —á—Ç–æ –º—É–∑—ã–∫–∞ –∏–≥—Ä–∞–µ—Ç
   */
  const playBackgroundMusic = useCallback(async (): Promise<void> => {
    // ========================================
    // 1Ô∏è‚É£ –ü–†–û–í–ï–†–ö–ê –í–ö–õ–Æ–ß–ï–ù–ê –õ–ò –ú–£–ó–´–ö–ê
    // ========================================

    if (!audioSettings.musicEnabled) {
      console.log('üîá –ú—É–∑—ã–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö');
      return;
    }

    // ========================================
    // 2Ô∏è‚É£ –ü–†–û–í–ï–†–ö–ê –£–ñ–ï –õ–ò –ò–ì–†–ê–ï–¢ –ú–£–ó–´–ö–ê
    // ========================================

    /**
     * –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ú–û–ú–ï–ù–¢: –µ—Å–ª–∏ –º—É–∑—ã–∫–∞ —É–∂–µ –∏–≥—Ä–∞–µ—Ç, –ù–ï –∑–∞–ø—É—Å–∫–∞–µ–º –µ—ë —Å–Ω–æ–≤–∞
     * 
     * –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:
     * - playBackgroundMusic() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –º–Ω–æ–≥–æ —Ä–∞–∑ (–ø—Ä–∏ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–∏ –∏–≥—Ä—ã, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ)
     * - –ï—Å–ª–∏ –Ω–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —ç—Ç–æ—Ç —Ñ–ª–∞–≥, –º—É–∑—ã–∫–∞ –Ω–∞—á–Ω—ë—Ç –ø—Ä–æ–∏–≥—Ä—ã–≤–∞—Ç—å—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
     * - –≠—Ç–æ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ —Å—Ç—Ä–∞–Ω–Ω—ã–º –∑–≤—É–∫–∞–º –∏ —É—Ç–µ—á–∫–∞–º –ø–∞–º—è—Ç–∏
     * 
     * –†–µ—à–µ–Ω–∏–µ: –∏—Å–ø–æ–ª—å–∑—É–µ–º backgroundMusicPlayingRef –∫–æ—Ç–æ—Ä–∞—è —Ö—Ä–∞–Ω–∏—Ç —ç—Ç–æ—Ç —Ñ–ª–∞–≥
     */
    if (backgroundMusicPlayingRef.current) {
      console.log('‚è∏Ô∏è –ú—É–∑—ã–∫–∞ —É–∂–µ –∏–≥—Ä–∞–µ—Ç, –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ–º —Å–Ω–æ–≤–∞');
      return;
    }

    try {
      // ========================================
      // 3Ô∏è‚É£ –ü–û–õ–£–ß–ï–ù–ò–ï SOUND –û–ë–™–ï–ö–¢–ê
      // ========================================

      const sound = soundsRef.current['background_music'];

      if (sound) {
        // ========================================
        // 4Ô∏è‚É£ –û–°–¢–ê–ù–û–í–ö–ê –ï–°–õ–ò –í–î–†–£–ì –ò–ì–†–ê–ï–¢
        // ========================================

        /**
         * –ù–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –º—É–∑—ã–∫–∞ –ø–æ—á–µ–º—É-—Ç–æ —É–∂–µ –±—ã–ª–∞ –∑–∞–ø—É—â–µ–Ω–∞
         * –ù–æ —Ñ–ª–∞–≥ –Ω–µ –±—ã–ª –æ–±–Ω–æ–≤–ª—ë–Ω
         */
        try {
          await sound.stopAsync();
        } catch (e) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫—É - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –±—ã–ª–æ
        }

        // ========================================
        // 5Ô∏è‚É£ –£–°–¢–ê–ù–û–í–ö–ê –ì–†–û–ú–ö–û–°–¢–ò
        // ========================================

        const volume = audioSettings.musicVolume / 100;
        await sound.setVolumeAsync(volume);

        // ========================================
        // 6Ô∏è‚É£ –í–ö–õ–Æ–ß–ï–ù–ò–ï –¶–ò–ö–õ–ò–ß–ï–°–ö–û–ì–û –í–û–°–ü–†–û–ò–ó–í–ï–î–ï–ù–ò–Ø
        // ========================================

        /**
         * isLooping: true - –º—É–∑—ã–∫–∞ –±—É–¥–µ—Ç –ø–æ–≤—Ç–æ—Ä—è—Ç—å—Å—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ
         * –ö–æ–≥–¥–∞ –æ–Ω–∞ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è, –Ω–∞—á–Ω—ë—Ç—Å—è —Å–Ω–æ–≤–∞ —Å –Ω–∞—á–∞–ª–∞
         */
        await sound.setIsLoopingAsync(true);

        // ========================================
        // 7Ô∏è‚É£ –ó–ê–ü–£–°–ö –° –ù–ê–ß–ê–õ–ê
        // ========================================

        /**
         * –í—Å–µ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞–µ–º —Å –Ω–∞—á–∞–ª–∞ —Ñ–∞–π–ª–∞
         * –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —á—Ç–æ –º—ã –Ω–µ –ø—Ä–æ–¥–æ–ª–∂–∏–º —Å —Å–µ—Ä–µ–¥–∏–Ω—ã
         */
        await sound.setPositionAsync(0);

        // –ó–∞–ø—É—Å–∫–∞–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
        await sound.playAsync();

        // ========================================
        // 8Ô∏è‚É£ –£–°–¢–ê–ù–û–í–ö–ê –§–õ–ê–ì–ê
        // ========================================

        /**
         * –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ —á—Ç–æ –º—É–∑—ã–∫–∞ —Å–µ–π—á–∞—Å –∏–≥—Ä–∞–µ—Ç
         * –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫
         */
        backgroundMusicPlayingRef.current = true;
        console.log('üéµ –§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞');
      }

    } catch (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —Ñ–æ–Ω–æ–≤–æ–π –º—É–∑—ã–∫–∏:', error);
      backgroundMusicPlayingRef.current = false; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –ø—Ä–∏ –æ—à–∏–±–∫–µ
    }

  }, [audioSettings.musicEnabled, audioSettings.musicVolume]);

  // ========================================
  // ‚èπÔ∏è –û–°–¢–ê–ù–û–í–ö–ê –§–û–ù–û–í–û–ô –ú–£–ó–´–ö–ò
  // ========================================

  /**
   * stopBackgroundMusic - –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–æ–Ω–æ–≤—É—é –º—É–∑—ã–∫—É
   * 
   * –õ–û–ì–ò–ö–ê:
   * 1. –ü–æ–ª—É—á–∞–µ–º Sound –æ–±—ä–µ–∫—Ç
   * 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω –ª–∏ –∑–≤—É–∫ –ø–µ—Ä–µ–¥ –æ—Å—Ç–∞–Ω–æ–≤–∫–æ–π
   * 3. –ï—Å–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω - –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º
   * 4. –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ musicPlaying
   * 5. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ "Player does not exist" (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)
   * 
   * –í–ê–ñ–ù–û: —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏:
   * - –í—ã—Ö–æ–¥–µ –∏–∑ –∏–≥—Ä—ã (handleExitWithSave/handleExitWithoutSave)
   * - –í–∫–ª—é—á–µ–Ω–∏–∏ –ø–∞—É–∑—ã
   * - –†–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (–≤ cleanup —Ñ—É–Ω–∫—Ü–∏–∏)
   */
  const stopBackgroundMusic = useCallback(async (): Promise<void> => {
    try {
      // ========================================
      // 1Ô∏è‚É£ –ü–û–õ–£–ß–ï–ù–ò–ï SOUND –û–ë–™–ï–ö–¢–ê
      // ========================================

      const sound = soundsRef.current['background_music'];

      if (sound) {
        // ========================================
        // 2Ô∏è‚É£ –ü–†–û–í–ï–†–ö–ê –ó–ê–ì–†–£–ñ–ï–ù –õ–ò –ó–í–£–ö
        // ========================================

        /**
         * getStatusAsync() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º –∑–≤—É–∫–∞
         * –í–∫–ª—é—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é: –∑–∞–≥—Ä—É–∂–µ–Ω –ª–∏ –∑–≤—É–∫, –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç—Å—è –ª–∏ –∏ —Ç.–¥.
         * 
         * –ï—Å–ª–∏ –∑–≤—É–∫ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω, status.isLoaded –±—É–¥–µ—Ç false
         */
        const status = await sound.getStatusAsync();

        if (status.isLoaded) {
          // ========================================
          // 3Ô∏è‚É£ –û–°–¢–ê–ù–û–í–ö–ê
          // ========================================

          await sound.stopAsync();
          backgroundMusicPlayingRef.current = false;
          console.log('‚èπÔ∏è –§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞');

        } else {
          /**
           * –ó–≤—É–∫ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω, —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏
           * –ü—Ä–æ—Å—Ç–æ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥
           */
          console.log('‚ÑπÔ∏è –ó–≤—É–∫ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –æ—Å—Ç–∞–Ω–æ–≤–∫—É');
          backgroundMusicPlayingRef.current = false;
        }
      }

    } catch (error) {
      // ========================================
      // ‚ö†Ô∏è –û–ë–†–ê–ë–û–¢–ö–ê –û–®–ò–ë–û–ö
      // ========================================

      /**
       * –û—à–∏–±–∫–∞ "Player does not exist" - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞
       * –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–æ–π—Ç–∏ –µ—Å–ª–∏:
       * - –ó–≤—É–∫ —É–∂–µ –±—ã–ª –≤—ã–≥—Ä—É–∂–µ–Ω (unload)
       * - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–ª—Å—è
       * - –ü–ª–µ–µ—Ä –±—ã–ª –æ—á–∏—â–µ–Ω —Å–∏—Å—Ç–µ–º–æ–π
       * 
       * –ú—ã –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É–µ–º —ç—Ç–æ –∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥
       */
      if (error instanceof Error && error.message.includes('Player does not exist')) {
        console.log('‚ÑπÔ∏è Player —É–∂–µ —É–¥–∞–ª–µ–Ω, –æ—à–∏–±–∫–∞ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∞');
        backgroundMusicPlayingRef.current = false;

      } else {
        /**
         * –î—Ä—É–≥–∏–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É–µ–º –∫–∞–∫ –ø—Ä–æ–±–ª–µ–º—É
         */
        console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –º—É–∑—ã–∫–∏:', error);
      }
    }

  }, []);

  // ========================================
  // üîä –û–ë–ù–û–í–õ–ï–ù–ò–ï –ì–†–û–ú–ö–û–°–¢–ò –í –†–ï–ê–õ–¨–ù–û–ú –í–†–ï–ú–ï–ù–ò
  // ========================================

  /**
   * Effect –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–æ–º–∫–æ—Å—Ç–∏ –≤—Å–µ—Ö –∑–≤—É–∫–æ–≤ –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑–º–µ–Ω–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
   * 
   * –ü–†–û–¶–ï–°–°:
   * 1. –ö–æ–≥–¥–∞ audioSettings.soundsVolume –∏–∑–º–µ–Ω—è–µ—Ç—Å—è (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–≤–∏–≥–∞–µ—Ç —Å–ª–∞–π–¥–µ—Ä)
   * 2. –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º –∑–≤—É–∫–∞–º
   * 3. –û–±–Ω–æ–≤–ª—è–µ–º –∏—Ö –≥—Ä–æ–º–∫–æ—Å—Ç—å –Ω–∞ –ª–µ—Ç—É
   * 4. –¢–æ –∂–µ —Å–∞–º–æ–µ –¥–ª—è –º—É–∑—ã–∫–∏
   * 
   * –≠—Ç–æ —Å–æ–∑–¥–∞—ë—Ç –æ—â—É—â–µ–Ω–∏–µ —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≥—Ä–æ–º–∫–æ—Å—Ç–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
   * –ï—Å–ª–∏ –∑–≤—É–∫ —Å–µ–π—á–∞—Å –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç—Å—è, –µ–≥–æ –≥—Ä–æ–º–∫–æ—Å—Ç—å –∏–∑–º–µ–Ω–∏—Ç—Å—è –ø—Ä—è–º–æ –≤–æ –≤—Ä–µ–º—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
   */
  useEffect(() => {
    /**
     * updateVolumes - –æ–±–Ω–æ–≤–ª—è–µ—Ç –≥—Ä–æ–º–∫–æ—Å—Ç—å –≤—Å–µ—Ö –∑–≤—É–∫–æ–≤
     */
    const updateVolumes = async (): Promise<void> => {
      try {
        // ========================================
        // 1Ô∏è‚É£ –û–ë–ù–û–í–õ–ï–ù–ò–ï –ì–†–û–ú–ö–û–°–¢–ò –ó–í–£–ö–û–í
        // ========================================

        /**
         * –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç (0-100) –≤ –¥–∏–∞–ø–∞–∑–æ–Ω (0-1)
         * –∫–æ—Ç–æ—Ä—ã–π –æ–∂–∏–¥–∞–µ—Ç Audio API
         */
        const soundsVolume = audioSettings.soundsVolume / 100;

        /**
         * –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º –∑–≤—É–∫–∞–º –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–æ–º–∫–æ—Å—Ç—å
         * 
         * –ò—Å–ø–æ–ª—å–∑—É–µ–º forEach –≤–º–µ—Å—Ç–æ —Ü–∏–∫–ª–∞ –ø–æ—Ç–æ–º—É —á—Ç–æ —ç—Ç–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
         * –∏ –º—ã –Ω–µ –∂–¥—ë–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–Ω–µ await)
         */
        Object.values(soundsRef.current).forEach((sound: Audio.Sound | undefined) => {
          if (sound) {
            /**
             * .catch() –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –æ—à–∏–±–∫—É –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫
             * (–Ω–∞–ø—Ä–∏–º–µ—Ä –∑–≤—É–∫ –±—ã–ª –≤—ã–≥—Ä—É–∂–µ–Ω)
             */
            sound.setVolumeAsync(soundsVolume).catch(err =>
              console.error('Error updating sound volume:', err)
            );
          }
        });

        // ========================================
        // 2Ô∏è‚É£ –û–ë–ù–û–í–õ–ï–ù–ò–ï –ì–†–û–ú–ö–û–°–¢–ò –ú–£–ó–´–ö–ò
        // ========================================

        /**
         * –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–æ–º–∫–æ—Å—Ç—å –º—É–∑—ã–∫–∏ –æ—Ç–¥–µ–ª—å–Ω–æ
         * –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç –≤ –¥–∏–∞–ø–∞–∑–æ–Ω 0-1
         */
        if (soundsRef.current['background_music']) {
          const musicVolume = audioSettings.musicVolume / 100;
          await soundsRef.current['background_music'].setVolumeAsync(musicVolume);
        }

        console.log('üîä –ì—Ä–æ–º–∫–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞');

      } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–æ–º–∫–æ—Å—Ç–∏:', error);
      }
    };

    // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
    updateVolumes();

  }, [audioSettings.soundsVolume, audioSettings.musicVolume]); // –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

  // ========================================
  // üì§ –í–û–ó–í–†–ê–©–ê–ï–ú–û–ï –ó–ù–ê–ß–ï–ù–ò–ï
  // ========================================

  /**
   * –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ä–µ–∫—Ç —Å –ø—É–±–ª–∏—á–Ω—ã–º API —Ö—É–∫–∞
   * –≠—Ç–æ —Ç–æ —á—Ç–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–≤—É–∫–∞–º–∏
   */
  return {
    playSound,              // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–æ–≤
    playBackgroundMusic,    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –º—É–∑—ã–∫–∏
    stopBackgroundMusic,    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –º—É–∑—ã–∫–∏
  };
};
