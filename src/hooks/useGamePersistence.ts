/**
 * üíæ useGamePersistence.ts - –°–∏—Å—Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä—ã
 * 
 * –û–°–ù–û–í–ù–û–ô –§–£–ù–ö–¶–ò–û–ù–ê–õ:
 * ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã –≤ AsyncStorage
 * ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–π –∏–≥—Ä—ã
 * ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
 * ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–π –∏–≥—Ä—ã
 * ‚úÖ –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
 * ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º
 * 
 * –†–ê–ë–û–¢–ê–ï–¢ –°:
 * - AsyncStorage: –Ω–∞—Ç–∏–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
 * - GameState: —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã (—Ñ–∏–≥—É—Ä—ã, –¥–æ—Å–∫–∞, –æ—á–∫–∏)
 * - GameConfig: –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–≥—Ä—ã (—Ä–∞–∑–º–µ—Ä –¥–æ—Å–∫–∏, —Å–∫–æ—Ä–æ—Å—Ç—å)
 * 
 * –ò–°–ü–û–õ–¨–ó–£–ï–¢:
 * - –ö–ª—é—á–∏ –≤ AsyncStorage –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
 * - –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö
 * - JSON —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–ª–æ–∂–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
 */

import { useCallback } from 'react';
import AsyncStorage from '@react-native-async-storage/async-storage';
import { GameState, GameConfig, DEFAULT_GAME_CONFIG } from '../types/game';
import { Tetromino } from '../types/tetromino';

// ========================================
// üì¶ –ö–û–ù–°–¢–ê–ù–¢–´ –ò –ö–õ–Æ–ß–ò
// ========================================

/**
 * STORAGE_KEYS - –∫–ª—é—á–∏ –¥–ª—è AsyncStorage
 * 
 * AsyncStorage —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (–∫–∞–∫ localStorage –≤ –±—Ä–∞—É–∑–µ—Ä–µ)
 * –ù–∞–º –Ω—É–∂–Ω—ã —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
 * 
 * –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è:
 * - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–∞–∑–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ—Ç–¥–µ–ª—å–Ω–æ –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞
 * - –ë—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –Ω—É–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
 * - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å –¥—Ä—É–≥–∏–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏
 */
const STORAGE_KEYS = {
  GAME_STATE: 'tetris_game_state',    // –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –∏–≥—Ä—ã
  GAME_CONFIG: 'tetris_game_config',  // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–≥—Ä—ã
  HIGH_SCORE: 'tetris_high_score',    // –õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  STATS: 'tetris_player_stats',       // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–∞
};

// ========================================
// üìä –ò–ù–¢–ï–†–§–ï–ô–°–´
// ========================================

/**
 * SavedGameState - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
 * 
 * –°–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–≥—Ä—ã –≤ —Ç–æ—á–Ω–æ—Å—Ç–∏ —Ç–∞–∫–æ–π –∂–µ,
 * –∫–∞–∫ –æ–Ω–∞ –±—ã–ª–∞ –≤ –º–æ–º–µ–Ω—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
 */
interface SavedGameState {
  /**
   * version - –≤–µ—Ä—Å–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
   * 
   * –ó–ê–ß–ï–ú –ù–£–ñ–ù–ê:
   * - –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è
   * - –ü–æ –≤–µ—Ä—Å–∏–∏ –º–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –µ—Å—Ç—å –ª–∏ –Ω—É–∂–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
   * - –ù–∞–ø—Ä–∏–º–µ—Ä: –≤–µ—Ä—Å–∏—è 1.0 ‚Üí 2.0, –Ω—É–∂–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
   * 
   * @example '1.0'
   */
  version: string;

  /**
   * timestamp - –≤—Ä–µ–º—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö —Å –Ω–∞—á–∞–ª–∞ —ç–ø–æ—Ö–∏)
   * 
   * –ó–ê–ß–ï–ú –ù–£–ñ–ù–ê:
   * - –£–∑–Ω–∞—Ç—å –∫–æ–≥–¥–∞ –±—ã–ª–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –∏–≥—Ä–∞
   * - –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è "–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ 30 –º–∏–Ω –Ω–∞–∑–∞–¥"
   * - –î–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π –µ—Å–ª–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–æ
   */
  timestamp: number;

  /**
   * gameState - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
   * 
   * –°–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏:
   * - currentTetromino: —Ç–µ–∫—É—â–∞—è –ø–∞–¥–∞—é—â–∞—è —Ñ–∏–≥—É—Ä–∞
   * - nextTetrominos: –æ—á–µ—Ä–µ–¥—å —Å–ª–µ–¥—É—é—â–∏—Ö —Ñ–∏–≥—É—Ä
   * - board: —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–π –¥–æ—Å–∫–∏
   * - score: —Ç–µ–∫—É—â–∏–µ –æ—á–∫–∏
   * - level: —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
   * - –ò –æ—Å—Ç–∞–ª—å–Ω–æ–µ –∏–∑ GameState
   * 
   * –í–ê–ñ–ù–û:
   * - –ò—Å–ø–æ–ª—å–∑—É–µ–º Omit —á—Ç–æ–±—ã –∏—Å–∫–ª—é—á–∏—Ç—å –ø–æ–ª—è –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–ª—å–∑—è —Å–æ—Ö—Ä–∞–Ω—è—Ç—å (—Ñ—É–Ω–∫—Ü–∏–∏)
   * - –ù–æ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–∞–∑–∞–¥ currentTetromino –∏ nextTetrominos –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–º –Ω—É–∂–Ω—ã
   */
  gameState: Omit<GameState, 'currentTetromino' | 'nextTetrominos'> & {
    currentTetromino: Tetromino | null;  // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â—É—é —Ñ–∏–≥—É—Ä—É
    nextTetrominos: Tetromino[];         // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—á–µ—Ä–µ–¥—å —Ñ–∏–≥—É—Ä
  };

  /**
   * config - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–≥—Ä—ã –∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
   * 
   * –ù—É–∂–Ω–∞ —á—Ç–æ–±—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç—É –∂–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:
   * - boardWidth: —à–∏—Ä–∏–Ω–∞ –¥–æ—Å–∫–∏
   * - boardHeight: –≤—ã—Å–æ—Ç–∞ –¥–æ—Å–∫–∏
   * - initialSpeed: –Ω–∞—á–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –ø–∞–¥–µ–Ω–∏—è
   */
  config: GameConfig;
}

/**
 * PlayerStats - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–≥—Ä–æ–∫–∞
 * 
 * –ù–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ –≤—Å–µ –∏–≥—Ä—ã
 */
interface PlayerStats {
  gamesPlayed: number;    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—ã–≥—Ä–∞–Ω–Ω—ã—Ö –∏–≥—Ä
  totalScore: number;     // –°—É–º–º–∞ –≤—Å–µ—Ö –æ—á–∫–æ–≤
  totalLines: number;     // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—á–∏—â–µ–Ω–Ω—ã—Ö –ª–∏–Ω–∏–π
  totalWords: number;     // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤
  bestScore: number;      // –õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  bestLevel: number;      // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å
}

// ========================================
// ü™ù –ì–õ–ê–í–ù–´–ô –•–£–ö
// ========================================

/**
 * useGamePersistence - –∫–∞—Å—Ç–æ–º–Ω—ã–π —Ö—É–∫ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è–º–∏
 * 
 * –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è:
 * - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
 * - –ó–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–π –∏–≥—Ä—ã
 * - –ü—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
 * - –£–¥–∞–ª–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
 * 
 * @returns –æ–±—ä–µ–∫—Ç —Å –º–µ—Ç–æ–¥–∞–º–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è–º–∏
 */
export const useGamePersistence = () => {
  // ========================================
  // üíæ –°–û–•–†–ê–ù–ï–ù–ò–ï –ò–ì–†–´
  // ========================================

  /**
   * saveGame - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
   * 
   * –ü–†–û–¶–ï–°–°:
   * 1. –£–ø–∞–∫–æ–≤—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã –≤ –æ–±—ä–µ–∫—Ç SavedGameState
   * 2. –î–æ–±–∞–≤–ª—è–µ–º –≤–µ—Ä—Å–∏—é –∏ –≤—Ä–µ–º–µ–Ω–Ω—É—é –º–µ—Ç–∫—É
   * 3. –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ JSON
   * 4. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ AsyncStorage
   * 5. –õ–æ–≥–∏—Ä—É–µ–º —É—Å–ø–µ—Ö –∏–ª–∏ –æ—à–∏–±–∫—É
   * 
   * @param gameState - —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
   * 
   * @example
   * ```tsx
   * const { saveGame } = useGamePersistence();
   * 
   * // –ü—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ –∏–≥—Ä—ã:
   * await saveGame(gameState);
   * ```
   */
  const saveGame = useCallback(
    async (gameState: GameState): Promise<void> => {
      try {
        // ========================================
        // 1Ô∏è‚É£ –ü–û–î–ì–û–¢–û–í–ö–ê –î–ê–ù–ù–´–•
        // ========================================

        /**
         * –°–æ–∑–¥–∞—ë–º –æ–±—ä–µ–∫—Ç –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
         * –í–∫–ª—é—á–∞–µ–º –≤–µ—Ä—Å–∏—é –∏ –≤—Ä–µ–º–µ–Ω–Ω—É—é –º–µ—Ç–∫—É
         */
        const savedState: SavedGameState = {
          version: '1.0',                    // –í–µ—Ä—Å–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
          timestamp: Date.now(),             // –ö–æ–≥–¥–∞ –±—ã–ª–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ
          gameState,                         // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
          config: DEFAULT_GAME_CONFIG,       // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        };

        // ========================================
        // 2Ô∏è‚É£ –ü–†–ï–û–ë–†–ê–ó–û–í–ê–ù–ò–ï –í JSON
        // ========================================

        /**
         * JSON.stringify –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –æ–±—ä–µ–∫—Ç –≤ —Å—Ç—Ä–æ–∫—É
         * null, 2 - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
         */
        const jsonData = JSON.stringify(savedState);

        // ========================================
        // 3Ô∏è‚É£ –°–û–•–†–ê–ù–ï–ù–ò–ï –í ASYNCSTORAGE
        // ========================================

        /**
         * setItem —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ –∫–ª—é—á—É GAME_STATE
         * –≠—Ç–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –ø–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ–º await
         */
        await AsyncStorage.setItem(STORAGE_KEYS.GAME_STATE, jsonData);

        console.log('‚úÖ Game saved successfully');

      } catch (error) {
        console.error('‚ùå Error saving game:', error);
        throw error; // –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –¥–∞–ª—å—à–µ
      }
    },
    []
  );

  // ========================================
  // üìÇ –ó–ê–ì–†–£–ó–ö–ê –ò–ì–†–´
  // ========================================

  /**
   * loadGame - –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é –∏–≥—Ä—É
   * 
   * –ü–†–û–¶–ï–°–°:
   * 1. –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ AsyncStorage –ø–æ –∫–ª—é—á—É GAME_STATE
   * 2. –ü–∞—Ä—Å–∏–º JSON
   * 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Å–∏—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
   * 4. –í–æ–∑–≤—Ä–∞—â–∞–µ–º loadedData –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–æ–≤–æ–π –∏–≥—Ä—ã
   * 
   * @returns –æ–±—ä–µ–∫—Ç —Å { gameState, config } –∏–ª–∏ null –µ—Å–ª–∏ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
   * 
   * @example
   * ```tsx
   * const { loadGame } = useGamePersistence();
   * 
   * // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–≥—Ä—ã:
   * const loadedData = await loadGame();
   * if (loadedData) {
   *   navigation.navigate('Game', { savedGameData: loadedData });
   * }
   * ```
   */
  const loadGame = useCallback(async (): Promise<{
    gameState: GameState;
    config: GameConfig;
  } | null> => {
    try {
      // ========================================
      // 1Ô∏è‚É£ –ü–û–õ–£–ß–ï–ù–ò–ï –î–ê–ù–ù–´–• –ò–ó –•–†–ê–ù–ò–õ–ò–©–ê
      // ========================================

      /**
       * getItem –ø–æ–ª—É—á–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
       * –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç null
       */
      const jsonData = await AsyncStorage.getItem(STORAGE_KEYS.GAME_STATE);

      if (!jsonData) {
        console.log('‚ÑπÔ∏è No saved game found');
        return null;
      }

      // ========================================
      // 2Ô∏è‚É£ –ü–ê–†–°–ò–ù–ì JSON
      // ========================================

      /**
       * JSON.parse –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Å—Ç—Ä–æ–∫—É –æ–±—Ä–∞—Ç–Ω–æ –≤ –æ–±—ä–µ–∫—Ç
       */
      const savedState: SavedGameState = JSON.parse(jsonData);

      // ========================================
      // 3Ô∏è‚É£ –ü–†–û–í–ï–†–ö–ê –í–ï–†–°–ò–ò
      // ========================================

      /**
       * –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –≤–µ—Ä—Å–∏–∏
       * –ï—Å–ª–∏ –≤–µ—Ä—Å–∏—è –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç, –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –º–∏–≥—Ä–∞—Ü–∏—è
       */
      if (savedState.version !== '1.0') {
        console.warn('‚ö†Ô∏è Saved game version mismatch');
        // –í –±—É–¥—É—â–µ–º –∑–¥–µ—Å—å –º–æ–∂–µ—Ç –±—ã—Ç—å –∫–æ–¥ –º–∏–≥—Ä–∞—Ü–∏–∏
      }

      console.log('‚úÖ Game loaded successfully');

      // ========================================
      // 4Ô∏è‚É£ –í–û–ó–í–†–ê–¢ –î–ê–ù–ù–´–•
      // ========================================

      /**
       * –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ä–µ–∫—Ç —Å gameState –∏ config
       * –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–µ—Ä–µ–¥–∞–Ω—ã –Ω–∞ Game —ç–∫—Ä–∞–Ω
       */
      return {
        gameState: savedState.gameState,
        config: savedState.config,
      };

    } catch (error) {
      console.error('‚ùå Error loading game:', error);
      return null; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º null –ø—Ä–∏ –æ—à–∏–±–∫–µ
    }
  }, []);

  // ========================================
  // üîç –ü–†–û–í–ï–†–ö–ê –ù–ê–õ–ò–ß–ò–Ø –°–û–•–†–ê–ù–ï–ù–ò–Ø
  // ========================================

  /**
   * hasSavedGame - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–∞—è –∏–≥—Ä–∞
   * 
   * –ó–ê–ß–ï–ú:
   * - –ù–∞ HomeScreen –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å" —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
   * - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø–æ–∫–∞–∑ –¥–∏–∞–ª–æ–≥–∞ –µ—Å–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ—Ç
   * 
   * @returns true –µ—Å–ª–∏ –µ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, –∏–Ω–∞—á–µ false
   * 
   * @example
   * ```tsx
   * const { hasSavedGame } = useGamePersistence();
   * 
   * const exists = await hasSavedGame();
   * if (exists) {
   *   // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
   * }
   * ```
   */
  const hasSavedGame = useCallback(async (): Promise<boolean> => {
    try {
      /**
       * getItem –≤–µ—Ä–Ω—ë—Ç null –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç
       * –ú—ã –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å–ª–∏ –ª–∏ —á—Ç–æ-—Ç–æ
       */
      const exists = await AsyncStorage.getItem(STORAGE_KEYS.GAME_STATE);
      return exists !== null;

    } catch (error) {
      console.error('‚ùå Error checking saved game:', error);
      return false; // –ü—Ä–∏ –æ—à–∏–±–∫–µ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º —á—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ—Ç
    }
  }, []);

  // ========================================
  // üóëÔ∏è –£–î–ê–õ–ï–ù–ò–ï –°–û–•–†–ê–ù–ï–ù–ò–Ø
  // ========================================

  /**
   * clearSavedGame - —É–¥–∞–ª—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é –∏–≥—Ä—É
   * 
   * –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø –ö–û–ì–î–ê:
   * - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ù–æ–≤–∞—è –∏–≥—Ä–∞" –ø–æ–≤–µ—Ä—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π
   * - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ" –≤ pause –º–µ–Ω—é
   * - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç –∏–≥—Ä—É (game over)
   * 
   * @example
   * ```tsx
   * const { clearSavedGame } = useGamePersistence();
   * 
   * // –£–¥–∞–ª—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –Ω–æ–≤–æ–π –∏–≥—Ä–æ–π:
   * await clearSavedGame();
   * navigation.navigate('Game');
   * ```
   */
  const clearSavedGame = useCallback(async (): Promise<void> => {
    try {
      /**
       * removeItem —É–¥–∞–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ –∫–ª—é—á—É –∏–∑ AsyncStorage
       */
      await AsyncStorage.removeItem(STORAGE_KEYS.GAME_STATE);
      console.log('‚úÖ Saved game cleared');

    } catch (error) {
      console.error('‚ùå Error clearing saved game:', error);
      throw error;
    }
  }, []);

  // ========================================
  // üìä –°–û–•–†–ê–ù–ï–ù–ò–ï –°–¢–ê–¢–ò–°–¢–ò–ö–ò
  // ========================================

  /**
   * updateStats - –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–≥—Ä–æ–∫–∞ –ø–æ—Å–ª–µ –∏–≥—Ä—ã
   * 
   * –õ–û–ì–ò–ö–ê:
   * 1. –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
   * 2. –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–≥—Ä—ã
   * 3. –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
   * 
   * @param score - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—á–∫–æ–≤ –∑–∞ —ç—Ç—É –∏–≥—Ä—É
   * @param level - –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å
   * @param lines - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—á–∏—â–µ–Ω–Ω—ã—Ö –ª–∏–Ω–∏–π
   * @param words - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤
   */
  const updateStats = useCallback(
    async (score: number, level: number, lines: number, words: number): Promise<void> => {
      try {
        // ========================================
        // 1Ô∏è‚É£ –ó–ê–ì–†–£–ó–ö–ê –¢–ï–ö–£–©–ï–ô –°–¢–ê–¢–ò–°–¢–ò–ö–ò
        // ========================================

        const statsJson = await AsyncStorage.getItem(STORAGE_KEYS.STATS);
        const currentStats: PlayerStats = statsJson
          ? JSON.parse(statsJson)
          : {
              gamesPlayed: 0,
              totalScore: 0,
              totalLines: 0,
              totalWords: 0,
              bestScore: 0,
              bestLevel: 0,
            };

        // ========================================
        // 2Ô∏è‚É£ –û–ë–ù–û–í–õ–ï–ù–ò–ï –ó–ù–ê–ß–ï–ù–ò–ô
        // ========================================

        currentStats.gamesPlayed += 1;        // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—ã–≥—Ä–∞–Ω–Ω—ã—Ö –∏–≥—Ä
        currentStats.totalScore += score;     // –°—É–º–º–∏—Ä—É–µ–º –æ—á–∫–∏
        currentStats.totalLines += lines;     // –°—É–º–º–∏—Ä—É–µ–º –ª–∏–Ω–∏–∏
        currentStats.totalWords += words;     // –°—É–º–º–∏—Ä—É–µ–º —Å–ª–æ–≤–∞

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∫–æ—Ä–¥—ã –µ—Å–ª–∏ —Ç–µ–∫—É—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ª—É—á—à–µ
        if (score > currentStats.bestScore) {
          currentStats.bestScore = score;
        }
        if (level > currentStats.bestLevel) {
          currentStats.bestLevel = level;
        }

        // ========================================
        // 3Ô∏è‚É£ –°–û–•–†–ê–ù–ï–ù–ò–ï –û–ë–ù–û–í–õ–ï–ù–ù–û–ô –°–¢–ê–¢–ò–°–¢–ò–ö–ò
        // ========================================

        await AsyncStorage.setItem(STORAGE_KEYS.STATS, JSON.stringify(currentStats));
        console.log('‚úÖ Stats updated');

      } catch (error) {
        console.error('‚ùå Error updating stats:', error);
      }
    },
    []
  );

  // ========================================
  // üì§ –í–û–ó–í–†–ê–©–ê–ï–ú–û–ï –ó–ù–ê–ß–ï–ù–ò–ï
  // ========================================

  /**
   * –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ä–µ–∫—Ç —Å–æ –≤—Å–µ–º–∏ –º–µ—Ç–æ–¥–∞–º–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è–º–∏
   * 
   * –≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤:
   * - GameScreen: –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ
   * - HomeScreen: –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π
   * - –î—Ä—É–≥–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö: –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–≥—Ä–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
   */
  return {
    saveGame,           // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–≥—Ä—É
    loadGame,           // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–≥—Ä—É
    hasSavedGame,       // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    clearSavedGame,     // –£–¥–∞–ª–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    updateStats,        // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
  };
};
