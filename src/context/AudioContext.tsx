/**
 * üìª AudioContext.tsx - –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—É–¥–∏–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
 * 
 * –≠—Ç–æ—Ç —Ñ–∞–π–ª –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—É–¥–∏–æ–ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è,
 * –ø–æ–∑–≤–æ–ª—è—è –ª—é–±–æ–º—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É –ø–æ–ª—É—á–∞—Ç—å –∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º—É–∑—ã–∫–∏ –∏ –∑–≤—É–∫–æ–≤.
 * 
 * –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
 * - AudioSettings: –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
 * - AudioProvider: –ø–æ—Å—Ç–∞–≤—â–∏–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
 * - useAudio(): –∫–∞—Å—Ç–æ–º–Ω—ã–π —Ö—É–∫ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
 */

import React, { createContext, useContext, useState, ReactNode } from 'react';

// ========================================
// üéµ –ò–ù–¢–ï–†–§–ï–ô–°–´ –ò –¢–ò–ü–´
// ========================================

/**
 * AudioSettings - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∞—É–¥–∏–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
 * 
 * @property musicEnabled - –≤–∫–ª—é—á–µ–Ω–∞ –ª–∏ —Ñ–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞ (true/false)
 * @property musicVolume - –≥—Ä–æ–º–∫–æ—Å—Ç—å –º—É–∑—ã–∫–∏ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 0-100
 * @property soundsEnabled - –≤–∫–ª—é—á–µ–Ω—ã –ª–∏ –∑–≤—É–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ (true/false)
 * @property soundsVolume - –≥—Ä–æ–º–∫–æ—Å—Ç—å –∑–≤—É–∫–æ–≤ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 0-100
 */
interface AudioSettings {
  musicEnabled: boolean;      // –í–∫–ª—é—á–µ–Ω–∞ –ª–∏ –º—É–∑—ã–∫–∞
  musicVolume: number;        // –ì—Ä–æ–º–∫–æ—Å—Ç—å –º—É–∑—ã–∫–∏ (0-100)
  soundsEnabled: boolean;     // –í–∫–ª—é—á–µ–Ω—ã –ª–∏ –∑–≤—É–∫–∏
  soundsVolume: number;       // –ì—Ä–æ–º–∫–æ—Å—Ç—å –∑–≤—É–∫–æ–≤ (0-100)
}

/**
 * AudioContextType - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
 * 
 * –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞—É–¥–∏–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
 */
interface AudioContextType {
  audioSettings: AudioSettings;                              // –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  updateSettings: (settings: Partial<AudioSettings>) => void; // –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  resetSettings: () => void;                                 // –í–µ—Ä–Ω—É—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  getSettingsForDisplay: () => AudioSettings;               // –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
}

// ========================================
// üéõÔ∏è –ó–ù–ê–ß–ï–ù–ò–Ø –ü–û –£–ú–û–õ–ß–ê–ù–ò–Æ
// ========================================

/**
 * –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É–¥–∏–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
 * 
 * –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –ø—Ä–∏ —Å–±—Ä–æ—Å–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
 * - –ú—É–∑—ã–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞ –Ω–∞ 70%
 * - –ó–≤—É–∫–∏ –≤–∫–ª—é—á–µ–Ω—ã –Ω–∞ 70%
 */
const defaultSettings: AudioSettings = {
  musicEnabled: true,      // –ú—É–∑—ã–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  musicVolume: 70,         // –°—Ä–µ–¥–Ω—è—è –≥—Ä–æ–º–∫–æ—Å—Ç—å –¥–ª—è –º—É–∑—ã–∫–∏
  soundsEnabled: true,     // –ó–≤—É–∫–∏ –≤–∫–ª—é—á–µ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  soundsVolume: 70,        // –°—Ä–µ–¥–Ω—è—è –≥—Ä–æ–º–∫–æ—Å—Ç—å –¥–ª—è –∑–≤—É–∫–æ–≤
};

// ========================================
// üì¶ –°–û–ó–î–ê–ù–ò–ï –ö–û–ù–¢–ï–ö–°–¢–ê
// ========================================

/**
 * AudioContext - React –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∞—É–¥–∏–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
 * 
 * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ undefined –∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è AudioProvider
 */
const AudioContext = createContext<AudioContextType | undefined>(undefined);

// ========================================
// üèóÔ∏è –ü–†–û–í–ê–ô–î–ï–† –ö–û–ù–¢–ï–ö–°–¢–ê
// ========================================

/**
 * AudioProvider - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç-–ø—Ä–æ–≤–∞–π–¥–µ—Ä –¥–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∞—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
 * 
 * –û–±—ë—Ä—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –¥–µ–ª–∞–µ—Ç audioSettings –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –≤–µ–∑–¥–µ —á–µ—Ä–µ–∑ useAudio()
 * 
 * –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
 * ```tsx
 * <AudioProvider>
 *   <App />
 * </AudioProvider>
 * ```
 */
export const AudioProvider: React.FC<{ children: ReactNode }> = ({ children }) => {
  // ========================================
  // üéöÔ∏è –°–û–°–¢–û–Ø–ù–ò–ï
  // ========================================

  /**
   * audioSettings - —Ç–µ–∫—É—â–∏–µ –∞—É–¥–∏–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
   * 
   * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å–æ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
   * –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ updateSettings() –∏–ª–∏ resetSettings()
   */
  const [audioSettings, setAudioSettings] = useState<AudioSettings>(defaultSettings);

  // ========================================
  // üìù –ú–ï–¢–û–î–´ –û–ë–ù–û–í–õ–ï–ù–ò–Ø
  // ========================================

  /**
   * updateSettings - –æ–±–Ω–æ–≤–ª—è–µ—Ç –ª—é–±—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∞—É–¥–∏–æ
   * 
   * –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Å–ª–∏—è–Ω–∏–µ (merge): –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—è,
   * –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
   * 
   * @param settings - –æ–±—ä–µ–∫—Ç —Å –ø–æ–ª—è–º–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
   * 
   * @example
   * updateSettings({ musicVolume: 50 })    // –ò–∑–º–µ–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –≥—Ä–æ–º–∫–æ—Å—Ç—å –º—É–∑—ã–∫–∏
   * updateSettings({ musicEnabled: false }) // –û—Ç–∫–ª—é—á–∏—Ç—å —Ç–æ–ª—å–∫–æ –º—É–∑—ã–∫—É
   */
  const updateSettings = (settings: Partial<AudioSettings>): void => {
    setAudioSettings(prev => ({ ...prev, ...settings }));
  };

  /**
   * resetSettings - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
   * 
   * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–Ω–æ–ø–∫–æ–π "–°–±—Ä–æ—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫" –≤ SettingsScreen
   */
  const resetSettings = (): void => {
    setAudioSettings(defaultSettings);
  };

  /**
   * getSettingsForDisplay - –ø–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
   * 
   * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–ø–∏—é —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
   * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ UI
   * 
   * @returns —Ç–µ–∫—É—â–∏–µ audioSettings
   */
  const getSettingsForDisplay = (): AudioSettings => {
    return audioSettings;
  };

  // ========================================
  // üíæ –û–ë–™–ï–ö–¢ –ó–ù–ê–ß–ï–ù–ò–Ø –ö–û–ù–¢–ï–ö–°–¢–ê
  // ========================================

  /**
   * value - –æ–±—ä–µ–∫—Ç —Å–æ –≤—Å–µ–º–∏ –º–µ—Ç–æ–¥–∞–º–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
   * 
   * –ü–µ—Ä–µ–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ value –≤ Provider
   */
  const value: AudioContextType = {
    audioSettings,           // –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    updateSettings,          // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    resetSettings,           // –§—É–Ω–∫—Ü–∏—è —Å–±—Ä–æ—Å–∞
    getSettingsForDisplay,  // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è
  };

  // ========================================
  // üîå –í–û–ó–í–†–ê–©–ê–ï–ú–û–ï –ó–ù–ê–ß–ï–ù–ò–ï
  // ========================================

  return (
    <AudioContext.Provider value={value}>
      {children}
    </AudioContext.Provider>
  );
};

// ========================================
// ü™ù –ö–ê–°–¢–û–ú–ù–´–ô –•–£–ö USEAUDIO
// ========================================

/**
 * useAudio - –∫–∞—Å—Ç–æ–º–Ω—ã–π —Ö—É–∫ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è AudioContext
 * 
 * –ü–æ–∑–≤–æ–ª—è–µ—Ç –ª—é–±–æ–º—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∞—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
 * –í–ê–ñ–ù–û: –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±—ë—Ä–Ω—É—Ç –≤ AudioProvider
 * 
 * @returns –æ–±—ä–µ–∫—Ç —Å –º–µ—Ç–æ–¥–∞–º–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
 * 
 * @throws Error –µ—Å–ª–∏ —Ö—É–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω–µ AudioProvider
 * 
 * @example
 * ```tsx
 * const { audioSettings, updateSettings } = useAudio();
 * 
 * // –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –≥—Ä–æ–º–∫–æ—Å—Ç—å –º—É–∑—ã–∫–∏
 * console.log(audioSettings.musicVolume);
 * 
 * // –ò–∑–º–µ–Ω–∏—Ç—å –≥—Ä–æ–º–∫–æ—Å—Ç—å
 * updateSettings({ musicVolume: 80 });
 * ```
 */
export const useAudio = (): AudioContextType => {
  const context = useContext(AudioContext);
  
  // ========================================
  // ‚ö†Ô∏è –ü–†–û–í–ï–†–ö–ê –ù–ê–õ–ò–ß–ò–Ø –ü–†–û–í–ê–ô–î–ï–†–ê
  // ========================================

  /**
   * –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç undefined, –∑–Ω–∞—á–∏—Ç —Ö—É–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω–µ AudioProvider
   * –í—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É —Å –ø–æ–Ω—è—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
   */
  if (context === undefined) {
    throw new Error(
      'useAudio –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –≤–Ω—É—Ç—Ä–∏ AudioProvider. ' +
      '–û–±–µ—Ä–Ω–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ <AudioProvider> –≤ —Ñ–∞–π–ª–µ App.tsx'
    );
  }

  return context;
};
